name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    name: Java ${{ matrix.java }} | Gradle ${{ matrix.gradle }} | ${{ matrix.mysql }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        java: [ '17', '21', '25' ]
        gradle: [ '8.10.2', '9.2.1' ]
        mysql: [ 'mysql:8.0.33', 'mysql:latest' ]

    steps:
    - uses: actions/checkout@v4

    - name: Set up JDK ${{ matrix.java }}
      uses: actions/setup-java@v4
      with:
        java-version: ${{ matrix.java }}
        distribution: 'temurin'

    - name: Setup Gradle ${{ matrix.gradle }}
      uses: gradle/actions/setup-gradle@v4
      with:
        gradle-version: ${{ matrix.gradle }}

    - name: Run Tests
      # We use 'gradle' directly to use the version set up by the action, not the wrapper.
      # We pass the toolchain version to ensure Gradle uses the installed JDK for compilation/testing.
      # We pass the MySQL image version to the tests.
      run: gradle check -Djava.toolchain.version=${{ matrix.java }} -Dtest.mysql.image="${{ matrix.mysql }}" --info
